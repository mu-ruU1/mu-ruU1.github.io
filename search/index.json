[{"content":"はじめに ICT トラブルシューティングコンテストとは、ネットワーク・サーバー・セキュリティ・データベースなどを出題範囲とし、それに関するトラブルを特定・解決し報告書を提出するといった競技内容となってます。\n実際にトラブルが発生しているサーバーにアクセスし、課題解決に取り組みます。\n今回は５人でチームを組み参加しました。\n日程 2023 年３月４日～ ３月５日 の２日間オンラインで行われました。\n１日目 時間 予定 10:00 ～ 10:20 開会式 10:30 競技開始 16:30 競技終了 ２日目 時間 予定 10:00 競技開始 16:30 競技終了 17:30 ～ 19:00 閉会式 コンテスト前にやったこと 過去問を眺めていたところ、ネットワーク問題ではVyOSが使用されていたため、\nVyOS の基本的な操作を勉強しました。\n1 日目 この日はチーム同士オフラインで集まって取り組みました。\n奴の名は (1) この問題は、LDAP に保存されているaliceユーザーに ssh でログインできるようにするというものです。\n早速つまずきました。\nLDAP って何？？という状態だったので、まずはそこから調べました。\nとりあえず、ssh すると\n$ ssh alice@localhost alice@localhost\u0026#39;s password: Permission denied, please try again. このようにログインできませんでした。\n色々調べましたが、分からなかったため次の問題に移りました。\nなお２日目に再挑戦しました。\nping が飛ばない この問題は、Host01 から Host02 への ping が飛ばない原因を突き止めて解決するというものです。\nHost01,Router,Host02には VyOS がインストールされている状態です。\n+------------+ | | | Host01 | | 172.16.0.1 | +-----+------+ | | +-------+--------+ | 172.16.255.254 | | | | Router | | | | 172.17.255.254 | +-------+--------+ | | +-----+------+ | | | Host02 | | 172.17.0.1 | +------------+ まず、Host01 -\u0026gt; Routerでは ping が通るためHost01の静的ルーティングを疑い、見事設定されていないことが分かりました。\nset protocols static route 172.17.0.0/16 next-hop 172.16.255.254 設定をしても ping が通らなかったため、Routerのファイアウォールを見ました。\nとりあえず、icmp の許可を行いました。\nset firewall name ETH1-OUT rule 11 action accept set firewall name ETH1-OUT rule 11 protocol icmp 後は報告書を書いて提出し、満点を頂きました！！\nやらかしたかもしれない\u0026hellip; この問題は、sudo suを実行した後にcd /ができなくなるため、それをできるようにするというものです。\nuser@host01:~$ echo $SEHLL /bin/bash user@host01:~$ sudo su root@host01:/home/user# echo $SHELL /usr/bin/rbash 制限付きのbashであるrbashであることが分かり、\n$ ls -l /usr/bin/rbash lrwxrwxrwx 1 root root 4 Jan 7 2022 rbash -\u0026gt; bash bash のシンボリックリンクであり解除するコマンド\nunlink rbash を実行し解決しました。\nデータベースに入れない (1) この問題は、PCからRouterを挟んで MySQLServerにログインできるようにするというものです。\n+--------------+ | | | PC | | 172.16.1.128 | +-----+--------+ | | +-----+------+ | 172.16.1.1 | | | | Router | | | | 172.16.2.1 | +-----+------+ | | +-----+--------+ | | | Server | | 172.16.2.128 | +--------------+ MySQL サーバーの設定等は他のメンバーに頼み、自分はRouterのファイアウォール等を確認しました。\nset firewall name client-in rule 10 action accept set firewall name client-in rule 10 destination port 3306 set firewall name client-in rule 10 protocol tcp_udp しかし 200 点満点中 190 点だったため、残り 10 点の原因を模索しました。\nなお２日目に再挑戦しました。\n２日目 この日はチーム同士オンラインで取り組みました。\nオフラインの方が教え合いや議論が円滑に進み、\nやりやすいと感じました。\n奴の名は (2) /var/log/auth.logから ssh のアクセスログを見ました。\nエラーログをそのまま検索にかけると/etc/nsswitch.confを修正することで解決することが分かりましたが、些細なミスにより正解には辿り着けませんでした。\n俺自身が DHCP サーバーとなることだ この問題は、wsmhostの DHCP サーバーを設定した上で直接machine-xを接続し、疎通確認を取るというものでした。\n何も考えず、\n$ sudo systemctl start isc-dhcp-server をやってしまうと、wsmhostの ssh が切断され何もできなくなってしまいます。\n閉会式で、この問題が一番再展開された回数が多いことが分かり、みんな同じミスをしているのかと思いました。\nwsmhostには２つインターフェースがあり、それぞれデフォルトゲートウェイが設定されています。\nそこで、デフォルトゲートウェイが必要でないインターフェースの設定を見直しました。\nsubnet 10.0.0.0 netmask 255.255.255.0 { range 10.0.0.128 10.0.0.140; # option routers 10.0.0.1; \u0026lt;- コメントアウト option subnet-mask 255.255.255.0; option broadcast-address 10.0.0.255; default-lease-time 600; max-lease-time 7200; } これで、解決です。\nrange 10.0.0.128 10.0.0.140;により DHCP のアドレスが10.0.0.128から割り当てられると思っていました。\n10.0.0.128に ping が通りますが、実際machine-xには10.0.0.129が割り当たっていました。\nなぞです。 とりあえず、満点だったので良かった。\nuser@wsmhost:~$ sudo systemctl status isc-dhcp-server ● isc-dhcp-server.service - ISC DHCP IPv4 server Loaded: loaded (/lib/systemd/system/isc-dhcp-server.service; disabled; vendor preset: enabled) Active: active (running) since Sun 2023-03-05 10:51:59 JST; 2min 3s ago Docs: man:dhcpd(8) Main PID: 40497 (dhcpd) Tasks: 4 (limit: 1111) Memory: 4.5M CGroup: /system.slice/isc-dhcp-server.service └─40497 dhcpd -user dhcpd -group dhcpd -f -4 -pf /run/dhcp-server/dhcpd.pid -cf /etc/dhcp/dhcpd.conf eth0 Mar 05 10:51:59 wsmhost sh[40497]: Listening on LPF/eth0/9c:a3:ba:32:44:0a/10.0.0.0/24 Mar 05 10:51:59 wsmhost dhcpd[40497]: Sending on LPF/eth0/9c:a3:ba:32:44:0a/10.0.0.0/24 Mar 05 10:51:59 wsmhost sh[40497]: Sending on LPF/eth0/9c:a3:ba:32:44:0a/10.0.0.0/24 Mar 05 10:51:59 wsmhost dhcpd[40497]: Sending on Socket/fallback/fallback-net Mar 05 10:51:59 wsmhost sh[40497]: Sending on Socket/fallback/fallback-net Mar 05 10:51:59 wsmhost dhcpd[40497]: Server starting service. Mar 05 10:52:02 wsmhost dhcpd[40497]: DHCPDISCOVER from 9c:a3:ba:32:d5:13 via eth0 Mar 05 10:52:03 wsmhost dhcpd[40497]: DHCPOFFER on 10.0.0.129 to 9c:a3:ba:32:d5:13 (machine-x) via eth0 Mar 05 10:52:03 wsmhost dhcpd[40497]: DHCPREQUEST for 10.0.0.129 (10.0.0.128) from 9c:a3:ba:32:d5:13 (machine-x) via eth0 Mar 05 10:52:03 wsmhost dhcpd[40497]: DHCPACK on 10.0.0.129 to 9c:a3:ba:32:d5:13 (machine-x) via eth0 IPv6 の DHCP この問題はdhcp-serverに frr をインストールして、clientに IPv6 アドレス(2001:db8::/64)を配布し、疎通確認をするというものです。\nFRRouting が何のことか分からず、時間がかかりました。\nコマンドは Cisco に似ている気がします。\n$ sudo apt update \u0026amp;\u0026amp; sudo apt install frr frr-pythontools sudo vtyshで FRR に入り、eth0の設定をします。\n公式ドキュメントでDHCPの単語で検索をかけてもなかったため、\nIPv6 のページを見ていたらそれらしい説明がありました。\ninterface eth0 ipv6 address 2001:db8::1/64 ipv6 nd prefix 2001:db8::/64 no ipv6 nd suppress-ra ipv6 nd prefix 2001:0DB8:5009::/64 これにより、dhcp-serverが定期的に自身を広報するようになります。\nclientの方では、IPv6 の DHCP を有効にしました。\n# /etc/netplan/01-netcfg.yaml network: ethernets: eth0: addresses: - 192.168.6.2/24 dhcp4: \u0026#39;no\u0026#39; dhcp6: \u0026#39;yes\u0026#39; ## 変更箇所 routes: - to: 0.0.0.0/0 via: 192.168.6.254 nameservers: addresses: - \u0026lt;address\u0026gt; - \u0026lt;address\u0026gt; search: - localdomain renderer: networkd version: 2 clientでip aをすると、\nuser@client:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 9c:a3:ba:32:93:a0 brd ff:ff:ff:ff:ff:ff altname enp0s3 altname ens3 inet 192.168.6.2/24 brd 192.168.6.255 scope global eth0 valid_lft forever preferred_lft forever inet6 2001:db8::9ea3:baff:fe32:93a0/64 scope global dynamic mngtmpaddr noprefixroute valid_lft 2591712sec preferred_lft 604512sec inet6 fe80::9ea3:baff:fe32:93a0/64 scope link valid_lft forever preferred_lft forever これより、clientが2001:db8::/64のレンジ内でアドレスが付与されていることが確認できます。\nping 結果は、\nuser@dhcp-server:~$ ping 2001:db8::9ea3:baff:fe32:93a0 PING 2001:db8::9ea3:baff:fe32:93a0(2001:db8::9ea3:baff:fe32:93a0) 56 data bytes 64 bytes from 2001:db8::9ea3:baff:fe32:93a0: icmp_seq=1 ttl=64 time=0.170 ms 64 bytes from 2001:db8::9ea3:baff:fe32:93a0: icmp_seq=2 ttl=64 time=0.304 ms 64 bytes from 2001:db8::9ea3:baff:fe32:93a0: icmp_seq=3 ttl=64 time=0.211 ms 64 bytes from 2001:db8::9ea3:baff:fe32:93a0: icmp_seq=4 ttl=64 time=0.187 ms 64 bytes from 2001:db8::9ea3:baff:fe32:93a0: icmp_seq=5 ttl=64 time=0.221 ms ^C --- 2001:db8::9ea3:baff:fe32:93a0 ping statistics --- 5 packets transmitted, 5 received, 0% packet loss, time 4102ms rtt min/avg/max/mdev = 0.170/0.218/0.304/0.046 ms 満点を頂けました。\nデータベースに入れない (2) ルーターで 3306 ポートのTCP通信のみを許可する設定に変更しました。\nset firewall name client-in rule 10 action accept set firewall name client-in rule 10 destination port 3306 set firewall name client-in rule 10 protocol tcp また、Serverのファイアウォールの設定で IPv6 を不許可に変更しました。\n# /etc/default/ufw IPV6=no ２回修正し提出しましたが、点数は変わらず 190 点でした。\nトラブルシューターの初仕事 この問題は OSPF に変更したところ、pcからsv01,sv02それぞれにアクセスできなくなりそれを解決するというものです。\nあと一歩のところで解けなく悔しかったです。\n３台のルーターで OSPF を動かしているのですが、router-idが重複していたためそれを修正しました。\nしかし、それでも解決せず試行錯誤しましたが、断念しました。\nたかし先輩の K8s 作問 マニフェストを眺めたり、pod や svc のログを見たり意味のないことをしていました。\nまとめ ICTSC2022 では主にネットワーク系の問題を２人で取り組みました。\nKubernetes を軽く触ったことがあり、問題に取り組んでみましたが全く歯が立たずまだまだだなといった感じです。\n22 チーム中 14 位という結果となりましたが、とても良い刺激になりました。\n","date":"2023-03-05T23:56:18+09:00","permalink":"https://takag.me/p/2023-03-05/","title":"ICTSC 2022に参加しました"},{"content":"はじめに インストール時の注意と自分がやった設定等を書き残しておきます。\nインストール Asus Expertbook は電源ボタンを押した直後にF2キーを長押しすることで BIOS に入ることができます。\nUbuntu のインストールメディアからブートするとインストーラーが起動します。\nしかしTurn off RSTの警告が出てインストールを中断させられました。\nUbuntu 公式ドキュメントではレジストリエディタを使った Intel RST 構成を変更する方法が紹介されていますが、面倒だったので BIOS から Intel RST を無効にしました。\nAdvanced Mode で SATA 設定に入り SATA モードを AHCI に変更する これで Ubuntu をインストールすることができます。\nバッテリー充電制御 バッテリーの劣化を防ぐために設定します。\n$ sudo apt install -y powertop tlp tlp-rdw $ sudo powertop --auto-tune $ sudo tlp start 設定ファイル/etc/tlp.confの修正\n数値はお好みで\nSTART_CHARGE_THRESH_BAT0=75 STOP_CHARGE_THRESH_BAT0=80 シリアルを使用できるようにする ルーターの設定でシリアル接続を利用するために行いました。\n$ ll /dev/ttyUSB0 crw-rw---- 1 root dialout 188 /dev/ttyUSB0 ユーザーを dialout グループに追加する\n$ sudo gpasswd -a $USER dialout 再ログインすることで有効になります。\n","date":"2023-01-30T22:35:09+09:00","image":"https://takag.me/img/2023/01-30/desktop.png","permalink":"https://takag.me/p/2023-01-30/","title":"ノートPCにUbuntuをインストールしてみた"},{"content":"はじめに 自宅のネットワークを改造したい。\nそういう訳で NEC IX2007 を買いました。\nYAMAHA の VPN ルーターと迷ったのですがクラウド管理等が無料でできるということで NEC にしました。 今回は初期設定と VPN 設定までを行います。\n今後、VLAN の設定もしていきます。\nネットワーク構成 構築後のネットワーク構成\nAterm はブリッジモードで運用します。\nファームウェア更新 ファームウェア更新は無料で行えます。\nソフトウェアダウンロード手順通りに申請すれば、ダウンロードリンクをもらえます。\nバージョン 10 以上だと、NetMeister 経由で更新することができます。\n私は、Web 管理ページからソフトウェアのファイルをアップロードして更新を行いました。\nスーパーリセット パスワードを忘れてしまったときや設定データを工場出荷時の設定に戻す場合に使用します。\nランニングコンフィグ、スタートアップコンフィグが消去されます。\n中古で買ったので念のためしておきました。\nプログラムのロード中にCtrl+cでブートモニタモードに移行 ccコマンドでスタートアップコンフィグを削除 bコマンドでプログラムファイルのロードを開始 NEC Bootstrap Software Copyright (c) NEC Corporation 2001-2022. All rights reserved. %BOOT-INFO: Trying flash load, exec-image [ix2207-ms-10.7.18.ldc]. Loading: ############################ NEC Bootstrap Software, Version 17.1 Copyright (c) NEC Corporation 2001-2022. All rights reserved. boot[0]\u0026gt; cc Enter \u0026#34;Y\u0026#34; to clear startup configuration: Y % Startup configuration is cleared. NEC Bootstrap Software, Version 17.1 Copyright (c) NEC Corporation 2001-2022. All rights reserved. boot[0]\u0026gt; b NetMeister クラウド経由でルーターの管理をすることができます。\n無料で利用できるのがありがたい。\nDDNS やコンフィグの保存などもできます。\nまた CPU 使用率や温度の統計が見れたり、異常がある場合はメールで通知してくれたり、とても便利です。\nGmail などのフリーメールアドレスではアカウント作成できないので注意です。\nモード構成 IX2000 シリーズにはオペレーションモードと 3 つのコンフィグモードがあります。\nオペレーションモード\nプロンプト: Router#\nshow running-configできないので注意\nコンフィグモード\nグローバルコンフィグモード\nプロンプト: Router(config)#\n一般的な設定をする デバイスコンフィグモード\nプロンプト: Router(config-GigaEthernet0)#\n各ポートの物理的な設定をする インタフェースコンフィグモード\nプロンプト: Router(config-GigaEthernet0.0)#\n論理的な接続の設定をする NEC IX2207 について 2 個の独立 LAN ポートと、4 ポートのスイッチングハブポートを内蔵している。\n2 つの USB ポートは USB 型のデータ通信端末を取り付けることができるらしいです。\n筐体も小型で取り回しが良いです。\nちなみにファンレスです。\n初期設定 Web 管理ページに入るために最低限の設定を行います。\nまた Web 管理ページでは簡単な設定しかできないので注意です。\nユーザー作成、http サービスの有効、GE2 の起動、前面のかんたん操作ボタンを無効\nの設定です。\nRouter(config)# username \u0026lt;user\u0026gt; password plain \u0026lt;password\u0026gt; Router(config)# http-server username \u0026lt;user\u0026gt; Router(config)# http-server ip enable Router(config)# interface GigaEthernet2.0 Router(config-GigaEthernet2.0)# ip address 192.168.10.254/24 Router(config-GigaEthernet2.0)# no shutdown Router(config)# no usbmem button enable 後は、GE2 と PC を LAN ケーブルで接続し192.168.10.0/24のアドレスを設定する。\nWAN 設定 私の家では CATV 事業者が提供している光回線を利用しています。\nそのため、IP 接続とし WAN 側 IP アドレスは自動取得で設定しています。\nここで問題が\u0026hellip; いつまで経っても WAN 側 IP がふられない。\n色々調べた結果、ONU 直下に繋ぐ機器を変更した際は ONU の再起動を行う必要があると記載がありました。\nそれをやった結果解決しました。\nその他の設定 DHCP の設定、NTP サーバーの設定を行いました。\nVPN の設定も特に問題なくいけます。\n最後に Android12 から L2TP/IPSec の設定ができなくなりました。\nNEC IX でも IKEv2/IPSec の設定をコマンドで設定できるようなのですがよく分からないので断念しました。\nとりあえずアクセスランプがきれいです。\n参考 製品ページ 製品マニュアル ネットワークチェンジニアとして matsublog ","date":"2023-01-10T01:12:14+09:00","image":"https://takag.me/img/2023/01-10/nec-ix2207-o.jpg","permalink":"https://takag.me/p/2023-01-10/","title":"IX2207で自宅ネットワーク改造 (1)"},{"content":"はじめに 外出中に自宅のネットワークにアクセスしたいことがある。\nそういった場合に VPN を利用することでローカルネットワークへのリモートアクセスが可能になる。\nそこで今回は SoftEther VPN を使用した。\n手順 Proxmox VE Proxmox VEで VM の作成で気をつけることが 1 つある。\nデフォルトのネットワークデバイスのモデルはVirtIO (準仮想化)だと思うが、Intel E1000に変更するする必要がある。\nこれをしないと、上り下りのスループットが 3Mbps 程しか出ない。\nSoftEther VPN ダウンロード PPA を使用してインストールもできるが、バージョンが古いのでダウンロードサイトから手動で入れる。\n$ sudo apt install gcc make -y $ curl -O \u0026lt;ファイルのURL\u0026gt; $ tar xzvf \u0026lt;ファイル\u0026gt; $ cd vpnserver $ make $ cd .. $ sudo mv vpnserver /usr/local/softether $ cd /usr/local/softether/vpnserver $ chmod 600 * $ chmod 700 vpncmd vpnserver Systemd コレを参考に/etc/systemd/system/softether-vpnserver.serviceを作成する。\n[Unit] Description=SoftEther VPN Server After=network.target auditd.service ConditionPathExists=!/usr/local/softether/vpnserver/do_not_run [Service] Type=forking TasksMax=infinity EnvironmentFile=-/usr/local/softether/vpnserver ExecStart=/usr/local/softether/vpnserver/vpnserver start ExecStop=/usr/local/softether/vpnserver/vpnserver stop KillMode=process Restart=on-failure # Hardening PrivateTmp=yes ProtectHome=yes ProtectSystem=full ReadOnlyDirectories=/ ReadWriteDirectories=-/usr/local/softether/vpnserver CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_BROADCAST CAP_NET_RAW CAP_SYS_NICE CAP_SYSLOG CAP_SETUID [Install] WantedBy=multi-user.target その後\n$ sudo systemctl daemon-reload $ sudo systemctl start softether-vpnserver.service $ sudo systemctl enable softether-vpnserver.service $ sudo systemctl status softether-vpnserver.service あとはサーバー管理ツール等で VPN の設定をすれば完了です。\n参考 SoftEther speed is too slow ","date":"2022-12-30T16:04:42+09:00","image":"https://takag.me/img/2022/12-30/selogo.jpg","permalink":"https://takag.me/p/2022-12-30/","title":"SoftEther VPNをProxmoxで構築する"},{"content":"はじめに ネットワークの勉強のために 7 月頃に Cisco891F を買ったけれども、色々忙しくて全く触れていませんでした。 冬休みになって時間ができたのでこれから勉強していきたいと思います。\n事の発端 手始めに Cisco891F x 3 を使ってSVI を利用した VLAN 間ルーティングを試していたところ特定の条件で ping が通らないことが起こりました。\n具体的には、同一 VLAN では ping が通るが異なる VLAN 間では ping が通らないといった状態です。\n内容 VLAN10(172.16.10.0/24)に所属している PC から VLAN20(172.16.20.0/24)に所属している PC に ping を実行したときの結果が以下のようになりました。\nPS C:\\Users\\user\u0026gt; ping 172.16.20.1 172.16.20.1 に ping を送信しています 32 バイトのデータ: 要求がタイムアウトしました。 要求がタイムアウトしました。 要求がタイムアウトしました。 tracert を実行したときの結果も載せておきます。\nPS C:\\Users\\user\u0026gt; tracert 172.16.20.1 172.16.20.1 へのルートをトレースしています。経由するホップ数は最大 30 です 1 1 ms 1 ms \u0026lt;1 ms 172.16.10.254 2 * * * 要求がタイムアウトしました。 3 * * * 要求がタイムアウトしました。 4 * * * 要求がタイムアウトしました。 ルーターからはすべての SVI のデフォルトゲートウェイ・PC に ping が通るので PC 側に問題があると思って調べました。\n解決策 ファイアウォールのプロパティを見たところ、リモート IP アドレスがローカル サブサブネットになっていたことが原因だったことが判明しました。\nという訳で、リモート IP アドレスを任意のIPアドレスにすれば ping が通るようになります。\n","date":"2022-12-29T01:39:19+09:00","image":"https://takag.me/img/2022/12-29/cisco-891f.jpg","permalink":"https://takag.me/p/2022-12-29/","title":"ファイアウォールが原因でpingが通らなかった"},{"content":"はじめに ブログを開設しました。やる気があるときに書いていきます。\n初投稿はこのブログの技術的なことについて書き残しておこうと思います。\n技術スタック Golang Hugo Hugo Theme Stack Docker VScode Remote Containers GitHub Pages GitHub Actions Hugo について Go で記述された静的サイトジェネレーター\nマークダウン形式で記事が書けるのでとても簡単\n記事投稿の流れ 記事を生成 $ hugo new post/sample.md 記事を書く\nファイルパスは\u0026lt;site-name\u0026gt;/content/post $ hugo server GitHub に push\nGithub Action Workflow によりデプロイ完了！\nまとめ Go の勉強がてらに良さげなフレームワークを探してこれにたどり着きました。\n結局 Go の勉強にはなりませんでしたが\u0026hellip;\nそれはさておき、記事を量産できるよう頑張ります。\n参考 Categoris color different on posts and changes when opening a post ","date":"2022-12-21T19:16:28+09:00","image":"https://takag.me/img/2022/12-21/hugo-logo.jpeg","permalink":"https://takag.me/p/2022-12-21/","title":"Hello World"}]